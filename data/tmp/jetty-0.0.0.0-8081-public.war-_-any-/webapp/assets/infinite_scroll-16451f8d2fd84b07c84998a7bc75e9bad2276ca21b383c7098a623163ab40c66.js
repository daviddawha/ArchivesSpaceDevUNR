!function(t){function o(t,o,r,e){this.base_url=t,this.wrapper=o,this.elt=o.find(".infinite-record-container"),this.recordCount=r,this.scrollPosition=0,this.scrollbarElt=void 0,this.scrollCallbacks=[],this.initScrollbar(),this.initEventHandlers(),this.considerPopulatingWaypoints(!1,null,e),this.globalStyles=$("<style />"),$("head").append(this.globalStyles)}var r=2,e=50,l=500,n=5e3,i=void 0;o.prototype.scrollBy=function(t){var o=this,r=o.wrapper.offset().top;t>0&&o.elt.find(".waypoint:last")[0].getBoundingClientRect().bottom-r<o.wrapper.height()||(o.scrollPosition-=t,o.scrollPosition>0&&(o.scrollPosition=0),o.elt[0].style.transform="translateY("+o.scrollPosition+"px)",$.each(o.scrollCallbacks,function(t,o){o()}),i&&clearInterval(i),i=setTimeout(function(){o.considerPopulatingWaypoints(!0),o.updateScrollPosition()},e))},o.prototype.initEventHandlers=function(){var t=this,o=33,r=34,e=32,l=40,n=38;$(document).on("keydown",function(i){var a=t.wrapper.height();i.keyCode==r||i.keyCode==e&&!i.shiftKey?(t.scrollBy(a),i.preventDefault()):i.keyCode==o||i.keyCode==e&&i.shiftKey?(t.scrollBy(0-a),i.preventDefault()):i.keyCode==l?(t.scrollBy(15),i.preventDefault()):i.keyCode==n&&(t.scrollBy(-15),i.preventDefault())}),$(document).on("wheel",function(o){if(0==$(o.target).closest(".infinite-record-wrapper").length)return!0;o.preventDefault();var r=o.originalEvent.deltaY;t.scrollBy(r)})},o.prototype.initScrollbar=function(){var t=this;t.scrollbarElt=$('<div class="infinite-record-scrollbar" />'),t.scrollbarElt.append($('<div class="infinite-record-spacer" />').height(1e7)),t.scrollbarElt.height(t.wrapper.height()),t.scrollbarElt.css("top",t.wrapper.offset().top),t.scrollbarElt.css("left",t.wrapper.offset().left+t.wrapper.width()+5),t.scrollbarElt.scrollTop(0),t.scrollbarElt.on("scroll",function(){return t.updatingScrollbar?void(t.updatingScrollbar=!1):($.each(t.scrollCallbacks,function(t,o){o()}),t.scrollDragDelayTimer&&clearInterval(t.scrollDragDelayTimer),void(t.scrollDragDelayTimer=setTimeout(function(){var o=Math.floor(t.scrollbarElt.scrollTop()/t.scrollbarElt.find(".infinite-record-spacer").height()*t.recordCount);t.scrollToRecord(o)},l)))}),$("body").append(t.scrollbarElt)},o.prototype.registerScrollCallback=function(t){this.scrollCallbacks.push(t)},o.prototype.updateScrollPosition=function(){var t=this,o=t.elt.find(".infinite-record-record"),r=t.findClosestElement(o),e=$(o[r]).data("record-number"),l=e/t.recordCount*$(".infinite-record-spacer").height();t.updatingScrollbar=!0,t.scrollbarElt.scrollTop(l)},o.prototype.scrollToRecord=function(t){var o=this,r=o.wrapper.offset().top,e=$(".waypoint").first().data("waypoint-size"),l=Math.floor(t/e),n=function(t){var e=$("#record-number-"+t)[0].getBoundingClientRect().top;o.scrollPosition-=e-r,o.elt[0].style.transform="translateY("+o.scrollPosition+"px)",o.considerPopulatingWaypoints(!0,!1,function(){$.each(o.scrollCallbacks,function(t,o){o()})})};$($(".waypoint")[l]).is(".populated")?n(t):o.populateWaypoints($($(".waypoint")[l]),!1,function(){n(t)})},o.prototype.findClosestElement=function(t){var o=this;if(t.length<=1)return 0;var r=o.wrapper.offset().top,e=(t.first().offset().top-r,0),l=t.length-1,n=function(t){return t.getBoundingClientRect().top-r};if(n(t[e])<=0&&n(t[l])<=0)return l;for(;e+1<l&&n(t[e])<0&&n(t[l])>0;){var i=Math.floor((l-e)/2)+e,a=t[i],s=n(a);s>0?l=i:s<=0&&(e=i)}return Math.abs(n(t[e]))<Math.abs(n(t[l]))?e:l};var a=!1;o.prototype.considerPopulatingWaypoints=function(t,o,e){var l=this;if(e||(e=$.noop),!a||o){a=!0;var i=l.elt.find(".waypoint:not(.populated)"),s=l.findClosestElement(i),c=l.wrapper.offset().top;if(i.length>0&&Math.abs(i[s].getBoundingClientRect().top-c)<n){var p=Math.max(s-r/2,0),d=p+r;l.populateWaypoints(i.slice(p,d),t,function(){l.considerPopulatingWaypoints(t,!0,e)})}else e(),a=!1}},o.prototype.populateWaypoints=function(t,o,r){var e=this;r||(r=$.noop),t.addClass("populated");var l=0;$(t).each(function(n,i){var a=$(i).data("waypoint-number"),s=$(i).data("waypoint-size"),c=$(i).data("uris").split(";");$.ajax(e.url_for("waypoints"),{method:"GET",data:{urls:c}}).done(function(n){var p=e.elt.find(".infinite-record-record"),d=void 0,f=void 0,u=void 0;p.length>0&&(d=p[e.findClosestElement(p)]),d&&(f=d.getBoundingClientRect()),$(c).each(function(t,o){n[o]&&(recordNumber=a*s+t,$(i).append($('<div class="infinite-record-record" />').attr("id","record-number-"+recordNumber).data("record-number",recordNumber).data("uri",o).html(n[o])))}),o&&d&&(u=d.getBoundingClientRect(),e.scrollPosition+=f.top-u.top,e.elt[0].style.transform="translateY("+e.scrollPosition+"px)"),l+=1,t.length<=l&&r()})})},o.prototype.url_for=function(t){var o=this;return o.base_url+"/"+t},o.prototype.getClosestElement=function(){var t=this.elt.find(".infinite-record-record"),o=this.findClosestElement(t);return $(t.get(o))},t.InfiniteScroll=o}(window);