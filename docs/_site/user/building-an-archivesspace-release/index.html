<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Building an ArchivesSpace release - ArchivesSpace</title>
    <link rel="stylesheet" href="/archivesspace/assets/stylesheets/main.css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" defer></script>
    <script src="/archivesspace/assets/javascripts/site.js" type="text/javascript" charset="utf-8" defer></script>
    <script src="/archivesspace/assets/javascripts/main.js" type="text/javascript" charset="utf-8" defer></script>
    <link rel="alternate" type="application/atom+xml" href="/blog.xml">
  </head>
  <body>
    <div class="wrapper">

      <header class="top">
  <div class="row topbar">
    <h1 id="logo" class="logo">
  <a href="http://archivesspace.org/" title="ArchivesSpace">ArchivesSpace</a>
</h1>

    <nav>
      <ul id="navigation" class="navigation">
        <li><a href="https://archivesspace.atlassian.net/wiki/display/ADC/ArchivesSpace">Wiki</a></li>
        <li><a href="http://docs.archivesspace.org">User Docs</a></li>
        <li class="toggle"><button type="button" id="toggle-menu" class="button--teal">Menu</button></li>
      </ul>
    </nav>
  </div>
</header>


      <div id="content" class="row">

        <div id="sidebar" class="sidebar">
  <div>
    <!-- <h2>Search</h2> -->
    <div class="searchbox">
      <form onsubmit='google_site_search()'>
        <input type="text" id="google-search" class="searchbox-input" label="Search the docs searchbox" placeholder="Search the docs" />
      </form>

      <script language="Javascript" type="text/javascript">
          function google_site_search()
            {
                var query = document.getElementById("google-search").value;
                  window.open("http://google.com/search?q=" + query
                  + "%20site:" + "http://archivesspace.github.io/archivesspace");
                  }
                </script>
    </div>
  </div>
  <section>
    <nav>
      <h2>Basic administration</h2>
      <ul>
        <li><a href="/archivesspace/user/getting-started-with-archivesspace/">Getting started with ArchivesSpace</a></li>
        <li><a href="/archivesspace/user/running-archivesspace-as-a-unix-daemon/">ArchivesSpace as a Unix daemon</a></li>
        <li><a href="/archivesspace/user/running-archivesspace-as-a-windows-service/">ArchivesSpace as a Windows Service</a></li>
        <li><a href="/archivesspace/user/backup-and-recovery/">Backup and Recovery</a></li>
        <li><a href="/archivesspace/user/re-creating-indexes/">Re-creating Indexes</a></li>
        <li><a href="/archivesspace/user/resetting-passwords/">Resetting Passwords</a></li>
        <li><a href="/archivesspace/user/upgrading-to-a-new-release-of-archivesspace/">Upgrading ArchivesSpace</a>
          <ul style="margin-left: 10px;">
            <li><a href="/archivesspace/user/upgrading-to-1.1.0/">Upgrading to 1.1.0</a></li>
            <li><a href="/archivesspace/user/upgrading-to-1.1.1/">Upgrading to 1.1.1</a></li>
            <li><a href="/archivesspace/user/upgrading-to-1.5.0/">Upgrading to 1.5.0</a></li>
            <li><a href="/archivesspace/user/what-is-the-new-functionality-related-to-containers-and-container-management-in-1.5.0/">Container Management in 1.5.0</a></li>
            <li><a href="/archivesspace/user/upgrading-to-2.1.0/">Upgrading to 2.1.0</a></li>
          </ul>
        </li>
      </ul>
      <h2>Architecture and components</h2>
      <ul>
        <li><a href="/archivesspace/user/archivesspace-architecture-and-components">Architecture Overview</a></li>
        <li><a href="/archivesspace/user/jsonmodel----a-validated-archivesspace-record/">JSONModel -- a validated ArchivesSpace record</a></li>
        <li><a href="/archivesspace/user/the-archivesspace-backend/">ArchivesSpace backend</a></li>
        <li><a href="/archivesspace/user/background-jobs/">Background Jobs</a></li>
        <li><a href="/archivesspace/user/working-with-the-archivesspace-api/">ArchivesSpace API</a></li>
        <li><a href="/archivesspace/user/search-indexing/">Search Indexing</a></li>
        <li><a href="/archivesspace/user/the-archivesspace-public-user-interface/">ArchivesSpace Public User Interface</a></li>
        <li><a href="/archivesspace/user/oai-pmh-interface/">OAI-PMH Interface</a></li>
      </ul>
      <h2>Customization and configuration</h2>
      <ul>
        <li><a href="/archivesspace/user/configuring-archivesspace/">Configuring ArchivesSpace</a></li>
        <li><a href="/archivesspace/user/configuring-ldap-authentication/">Configuring LDAP Authentication</a></li>
        <li><a href="/archivesspace/user/adding-support-for-additional-username-password-based-authentication-backends/">Other Authentication Backends</a></li>
        <li><a href="/archivesspace/user/archivesspace-plug-ins/">ArchivesSpace Plug-ins</a></li>
        <li><a href="/archivesspace/user/customizing-text-in-archivesspace/">Customizing Text in ArchivesSpace</a></li>
        <li><a href="/archivesspace/user/theming-archivesspace/">Theming ArchivesSpace</a></li>
        <li><a href="/archivesspace/user/managing-frontend-assets-with-bower/">Managing Frontend Assets with Bower</a></li>
      </ul>
      <h2>Provisioning and server configuration</h2>
      <ul>
        <li><a href="/archivesspace/user/running-archivesspace-with-load-balancing-and-multiple-tenants/">Load Balancing and Multiple Tenants</a></li>
        <li><a href="/archivesspace/user/serving-archivesspace-over-subdomains/">ArchivesSpace with Subdomains</a></li>
        <li><a href="/archivesspace/user/serving-archivesspace-user-facing-applications-over-https/">ArchivesSpace over HTTPS</a></li>
        <li><a href="/archivesspace/user/jmeter-test-group-template/">JMeter Test Group Template</a></li>
        <li><a href="/archivesspace/user/running-archivesspace-against-mysql/">Running ArchivesSpace Against MySQL</a></li>
        <li><a href="/archivesspace/user/application-monitoring-with-new-relic/">Application Monitoring with New Relic</a></li>
        <li><a href="/archivesspace/user/running-archivesspace-under-a-prefix/">ArchivesSpace under a Prefix</a></li>
        <li><a href="/archivesspace/user/running-archivesspace-with-external-solr/">ArchivesSpace with External Solr</a></li>
        <li><a href="/archivesspace/user/tuning-archivesspace/">Tuning ArchivesSpace</a></li>
      </ul>
      <h2>Information for developers and code contributors</h2>
      <ul>
        <li><a href="/archivesspace/user/archivesspace-build-system/">ArchivesSpace Build System</a></li>
        <li><a href="/archivesspace/user/building-an-archivesspace-release/">Building an ArchivesSpace Release</a></li>
        <li><a href="/archivesspace/user/public-test-suite/">Public Test Suite</a></li>
        <li><a href="/archivesspace/user/selenium-test-suite/">Selenium Test Suite</a></li>
        <li><a href="/archivesspace/user/using-supervisord-for-development/">Using supervisord for Development</a></li>
        <li><a href="/archivesspace/user/docker/">Docker</a></li>
        <li><a href="/archivesspace/user/reports/">Reports</a></li>
        <li><a href="https://archivesspace.atlassian.net/wiki/spaces/ADC/pages/16449553/Contributing">Contributing to ArchivesSpace</a>
          <ul style="margin-left: 10px;">
            <li><a href="/archivesspace/user/contributor-license-agreements/">Contributor License Agreements</a></li>
          </ul>
        </li>
        <li><a href="/archivesspace/api">The API</a></li>
        <li><a href="/archivesspace/doc">Ruby YARD Documentation</a></li>
        <li><div class="status-circle status">Status:</div>
          <a href="https://travis-ci.org/archivesspace/archivesspace">Travis CI Status</a>
        </li>
      </ul>
      <h2>Importing and exporting data in ArchivesSpace</h2>
      <ul>
        <li><a href="/archivesspace/user/accession-csv-import-template/">Accession CSV Import Template</a></li>
        <li><a href="/archivesspace/user/assessment-csv-import-template/">Assessment CSV Import Template</a></li>
        <li><a href="/archivesspace/user/digital-object-csv-import-template/">Digital Object CSV Import Template</a></li>
        <li><a href="/archivesspace/user/archivesspace-repository-ead-exporter/">ArchivesSpace Repository EAD Exporter</a></li>
        <li><a href="/archivesspace/user/archivesspace-xsl-stylesheets/">ArchivesSpace XSL Stylesheets</a></li>
      </ul>
      <h2>Migration tools and data mapping</h2>
      <ul>
        <li><a href="/archivesspace/user/migration-tools-and-data-mapping/">Migration Tools and Data Mapping</a>
          <ul style="margin-left: 10px;">
            <li><a href="/archivesspace/user/migrating-data-from-archivists-toolkit-to-archivesspace-using-the-migration-tool/">Archivists' Toolkit Migration Instructions</a></li>
            <li><a href="/archivesspace/user/migrating-data-from-archon-to-archivesspace-using-the-migration-tool/">Archon Migration Instructions</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </section>
  <section>
    <h2>Contact</h2>
    <ul>
      <li><a href="https://twitter.com/archivesspace">Twitter</a></li>
      <li><a href="http://github.com/archivesspace/archivesspace">GitHub</a></li>
      <li><a href="mailto:ArchivesSpaceHome@lyrasis.org">Email</a></li>
    </ul>
  </section>
  <section>
    <h2>Contributing to this Documentation</h2>
    <p>The documentation files for this site are managed in the <a href="https://github.com/archivesspace/tech-docs">ArchivesSpace Technical Documentation Repository</a>.</p>
      <p>This documentation was based on the <a href="https://travis-ci.org">Travis CI</a> documentation. It uses <a href="https://github.com/jekyll/jekyll">Jekyll</a> and <a href="https://github.com/tripit/slate">Slate</a></p>
  </section>
</div><!-- /#sidebar -->


        <main id="main" class="main">
          
            <h1 class="title">Building an ArchivesSpace release</h2>
          
          <h2 id="try-to-tie-up-any-loose-ends">Try to tie up any loose ends</h2>

<p>Before doing the release, it’s a good idea to try and make sure nothing is left
hanging. Check JIRA for any “rejected” or started-but-not-accepted tickets,
since you don’t want to ship with code that hasn’t passed QA.</p>

<p>Also, take a look at all the Gemfile.lock files ( in backend, frontend, public,
etc ) and review the gem versions. Pay close attention to the Rails &amp; Friends
( ActiveSupport, ActionPack, etc ), Rack, and Sinatra versions and make sure
there have not been any security patch versions. There usually are, especially
since Rails sends fix updates rather frequently.</p>

<p>To update the gems, update the version in Gemfile, delete the Gemfile.lock, and
run ./build/run bootstrap to download everything. Then make sure your test
suite passes.</p>

<p>Once everything passes, commit your Gemfiles and Gemfile.lock files.</p>

<p>Review the various README docs and update them as necessary. In particular the
<code class="highlighter-rouge">UPGRADING.md</code> instructions should be updated to reference the current and new
release version numbers.</p>

<h2 id="clone-the-git-repository">Clone the git repository</h2>

<p>When building a release it is important to start from a clean repository. The safest
way of ensuring this is to clone the repo:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/archivesspace/archivesspace.git
</code></pre></div></div>

<p>This assumes you will be building a release from master. To build from a tag you will
need to additionally check out the tag, like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout [tag-name]
</code></pre></div></div>

<h2 id="build-the-archivesspace-technical-documentation">Build the ArchivesSpace technical documentation</h2>

<p>ArchivesSpace ships with the current documentation, located in “docs”
directory. By default, this is served out at
http://localhost:8888/archivesspace when the application is running.</p>

<p>This documentation is also hosted on <a href="http://archivesspace.github.io/archivesspace/">http://archivesspace.github.io/archivesspace/</a>,
with the last released version. This documentation consists of a <a href="http://jekyllrb.com/">Jekyll</a> site
build on the content of various READMEs, a <a href="https://github.com/tripit/slate">Slate</a> site ( for REST API
documentation ), and the Ruby <a href="http://yardoc.org/">YARD</a> documentation.</p>

<p>Instructions to build this can be seen on <a href="https://github.com/archivesspace/archivesspace/tree/gh-pages">the ArchivesSpace gh-pages branch</a>.
Important to note that these steps assume you’re using a standard Ruby, not
jRuby. Note that if any additional READMEs have been added to the repository, you will
need to add those to the <a href="https://github.com/archivesspace/archivesspace/tree/master/scripts">scripts/build_docs.rb</a>
script that rips apart the READMEs. Also, links in the site’s side bar need to be
added to <a href="https://github.com/archivesspace/archivesspace/blob/master/docs/_includes/sidebar.html">Jekyll’s
sidebar</a>.</p>

<p>Before the <code class="highlighter-rouge">build/run doc:build</code> step, be sure you run the <code class="highlighter-rouge">build/run backend:test</code> step. This will run all your tests, including the documentation_spec.rb spec, which runs through all the endpoints, generates factory bot fixture json, and spits it into a json file (endpoint_examples.json).</p>

<p>To build the documentation:</p>

<ol>
  <li>Check out a new branch from master:</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ git checkout -b new-document
</code></pre></div></div>

<ol>
  <li>
    <p>Make sure that <a href="https://github.com/archivesspace/archivesspace/blob/master/scripts/build_docs.rb#L7-L8">script/build_docs.rb</a> is up-to-date and update <a href="https://github.com/archivesspace/archivesspace/blob/master/docs/_includes/sidebar.html">Jekyll’s sidebar</a> if necessary.</p>
  </li>
  <li>Bootstrap your development environment by downloading all dependencies–JRuby, Gems, Solr, etc.
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ build/run bootstrap
</code></pre></div>    </div>
  </li>
  <li>Run the backend unit tests
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ build/run backend:test
</code></pre></div>    </div>
    <p>Alternatively, if only updating the API docs</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ build/run backend:test -Dspec='documentation_spec.rb'
</code></pre></div>    </div>
  </li>
  <li>Update the fallback_version value in common/asconstants.rb with the new version number so that the documentation will have the correct version number in the footer
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  fallback_version = "vX.X.X.a"
</code></pre></div>    </div>
  </li>
  <li>Rip apart the READMEs for content by running the doc:build ANT task
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ build/run doc:build
</code></pre></div>    </div>
  </li>
  <li>Build Slate/API docs (using a standard Ruby)
  <em>Note</em>: At present, middleman requires a bundler version &lt; 2.0 so the docs have been updated to reflect this.
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ cd docs/slate
  $ gem install bundler --version '&lt; 2.0'
  $ bundle install --binstubs
  $ ./bin/middleman build
  $ ./bin/middleman server # optional if you want to have a look at the site.
  $ rm -r ../api
  $ mv build ../api
</code></pre></div>    </div>
  </li>
  <li>Compile Jekyll
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ cd docs
  $ gem install bundler
  $ bundle install --binstubs
  $ ./bin/jekyll build
  $ ./bin/jekyll serve # optional if you want to have a look at the site.
</code></pre></div>    </div>
  </li>
  <li>Commit the docs directory to git then push it to the gh-pages branch
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ cd ../ # go to top of the working tree
  $ git add # all files related to the docs that just got created/updated (eg. docs/*, index.html files, etc) (do NOT add common/asconstants.rb)
  $ git commit # with appropriate commit message
  $  git subtree push --prefix docs origin gh-pages
  ( or, if you get a FF error )
  $ git push origin `git subtree split --prefix docs master`:gh-pages --force
</code></pre></div>    </div>
  </li>
  <li>Now merge in the docs directory back into master by committing the new-document
branch, creating a PR, and merging the PR</li>
</ol>

<h2 id="build-the-release">Build the release</h2>

<p>Building the actual release is very simple. Back on the master branch ( with
your docs updated ), run the following:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./scripts/build_release vX.X.X
</code></pre></div></div>

<p>Replace X.X.X with the version number. This will build and package a release in
a zip file.</p>

<h2 id="commit-and-tag-the-release">Commit and Tag the release</h2>

<p>The release process adds the version number to
<code class="highlighter-rouge">common/asconstants.rb</code>.  After you’ve run the <code class="highlighter-rouge">build_release</code>
script, you’ll need to commit that file then tag the release in git.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git add common/asconstants.rb
$ git commit -m "Updating to vX.X.X"
$ git tag vX.X.X
$ git push --tags
</code></pre></div></div>

<h2 id="build-the-release-announcement">Build the release announcement</h2>

<p>The release announcement needs to have all the tickets that make up the
changelog for the release. In the past, this list has been written into
markdown to add in the Github release page.</p>

<p>An easy way to do this is to export all the relevant tickets in JIRA ( that is,
all tickets accepted since the last release  ). Then use the following script
to make a markdown file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>require 'csv'

def csv2md(csv_file)

output = "release_#{Time.now.to_i}.md"
file = File.open(output, "w")

CSV.foreach(csv_file, :headers =&gt; true ) do |row|
  file &lt;&lt; "* #{ row["Issue Type"].upcase } [##{ row["Key"] }] ( https://archivesspace.atlassian.net/browse/#{ row["Key"] } ): #{ row["Summary"] }\n"
end

puts "Putting file to #{output}\n"

end

if __FILE__ == $0
  csv2md(ARGV[0])
end

</code></pre></div></div>

<p>Then make a release page in Github, upload the zip package and paste in the changelog text.</p>

<p>:package: :shipit: &amp; :pray:</p>

        </main>
      </div><!-- /#content -->

      <footer>
  <div class="row">
  </div>
</footer>

    </div><!-- /.wrapper -->
  </body>
</html>
